/*
 iFrame Resizer (iframeSizer.min.js ) - v3.5.0 - 2015-10-26
  Desc: Force cross domain iframes to size to content.
  Requires: iframeResizer.contentWindow.min.js to be loaded into the target frame.
  Copyright: (c) 2015 David J. Bradshaw - dave@bradshaw.net
  License: MIT
*/
!function(h){function z(a,c,g){"addEventListener"in h?a.addEventListener(c,g,!1):"attachEvent"in h&&a.attachEvent("on"+c,g)}function ha(a,c,g){"removeEventListener"in h?a.removeEventListener(c,g,!1):"detachEvent"in h&&a.detachEvent("on"+c,g)}function ia(){var a,c=["moz","webkit","o","ms"];for(a=0;a<c.length&&!D;a+=1)D=h[c[a]+"RequestAnimationFrame"];D||m("setup","RequestAnimationFrame not supported")}function m(a,c){G("log",a,c,b[a]?b[a].log:H)}function E(a,c){G("warn",a,c,!0)}function G(a,c,g,e){if(!0===
e&&"object"==typeof h.console){e=console;a=e[a];var r=I+"[",B="Host page: "+c;c=(h.top!==h.self&&(B=h.parentIFrame&&h.parentIFrame.getId?h.parentIFrame.getId()+": "+c:"Nested host page: "+c),B);a.call(e,r+c+"]",g)}}function ja(a){function c(){e("Height");e("Width");Q(function(){R(q);S(f)},q,"init")}function g(){var d=x.substr(L).split(":");return{iframe:b[d[0]].iframe,id:d[0],height:d[1],width:d[2],type:d[3]}}function e(d){var n=Number(b[f]["max"+d]),p=Number(b[f]["min"+d]);d=d.toLowerCase();var w=
Number(q[d]);m(f,"Checking "+d+" is in range "+p+"-"+n);p>w&&(w=p,m(f,"Set "+d+" to min value"));w>n&&(w=n,m(f,"Set "+d+" to max value"));q[d]=""+w}function r(){function d(){function w(){var A=0,F=!1;for(m(f,"Checking connection is from allowed list of origins: "+p);A<p.length;A++)if(p[A]===n){F=!0;break}return F}function M(){var A=b[f].remoteHost;return m(f,"Checking connection is from: "+A),n===A}return p.constructor===Array?w():M()}var n=a.origin,p=b[f].checkOrigin;if(p&&"null"!=""+n&&!d())throw Error("Unexpected message received from: "+
n+" for "+q.iframe.id+". Message was: "+a.data+". This error can be disabled by setting the checkOrigin: false option or by providing of array of trusted domains.");return!0}function B(){var d=q.type in{"true":1,"false":1,undefined:1};return d&&m(f,"Ignoring init message from meta parent page"),d}function k(d){m(f,"MessageCallback passed: {iframe: "+q.iframe.id+", message: "+d+"}");d={iframe:q.iframe,message:JSON.parse(d)};C(f,"messageCallback",d);m(f,"--")}function l(d,n){J(function(){var p=document.body.getBoundingClientRect();
var w=q.iframe.getBoundingClientRect();p=JSON.stringify({clientHeight:Math.max(document.documentElement.clientHeight,h.innerHeight||0),clientWidth:Math.max(document.documentElement.clientWidth,h.innerWidth||0),offsetTop:parseInt(w.top-p.top,10),offsetLeft:parseInt(w.left-p.left,10),scrollTop:h.pageYOffset,scrollLeft:h.pageXOffset});y("Send Page Info","pageInfo:"+p,d,n)},32)}function t(){function d(w,M){function A(){b[p]?l(b[p].iframe,p):n()}["scroll","resize"].forEach(function(F){m(p,w+F+" listener for sendPageInfo");
M(h,F,A)})}function n(){d("Remove ",ha)}var p=f;d("Add ",z);b[p].stopPageInfo=n}function v(){var d=!0;return null===q.iframe&&(E(f,"IFrame ("+q.id+") not found"),d=!1),d}function T(d){d=d.getBoundingClientRect();return U(f),{x:Math.floor(Number(d.left)+Number(u.x)),y:Math.floor(Number(d.top)+Number(u.y))}}function V(d){var n=d?T(q.iframe):{x:0,y:0},p={x:Number(q.width)+n.x,y:Number(q.height)+n.y};m(f,"Reposition requested from iFrame (offset x:"+n.x+" y:"+n.y+")");h.top!==h.self?h.parentIFrame?h.parentIFrame["scrollTo"+
(d?"Offset":"")](p.x,p.y):E(f,"Unable to scroll to requested position, window.parentIFrame not found"):(u=p,W(),m(f,"--"))}function W(){!1!==C(f,"scrollCallback",u)?S(f):u=null}function ka(d){d=d.split("#")[1]||"";var n=decodeURIComponent(d);(n=document.getElementById(n)||document.getElementsByName(n)[0])?(n=T(n),m(f,"Moving to in page link (#"+d+") at x: "+n.x+" y: "+n.y),u={x:n.x,y:n.y},W(),m(f,"--")):h.top!==h.self?h.parentIFrame?h.parentIFrame.moveToAnchor(d):m(f,"In page link #"+d+" not found and window.parentIFrame not found"):
m(f,"In page link #"+d+" not found")}function la(d){var n=!0;return b[d]||(n=!1,E(q.type+" No settings for "+d+". Message was: "+x)),n}function ma(){for(var d in b)y("iFrame requested init",X(d),document.getElementById(d),d)}var x=a.data,q={},f=null;if("[iFrameResizerChild]Ready"===x)ma();else if(I===(""+x).substr(0,L)&&x.substr(L).split(":")[0]in b){if(q=g(),f=q.id,!B()&&la(f)&&(m(f,"Received: "+x),v()&&r()))switch(b[f].firstRun&&(b[f].firstRun=!1),q.type){case "close":Y(q.iframe);break;case "message":k(x.substr(x.indexOf(":")+
Z+6));break;case "scrollTo":V(!1);break;case "scrollToOffset":V(!0);break;case "pageInfo":l(b[f].iframe,f);t();break;case "pageInfoStop":b[f]&&b[f].stopPageInfo&&(b[f].stopPageInfo(),delete b[f].stopPageInfo);break;case "inPageLink":ka(x.substr(x.indexOf(":")+Z+9));break;case "reset":aa(q);break;case "init":c();C(f,"initCallback",q.iframe);C(f,"resizedCallback",q);break;default:c(),C(f,"resizedCallback",q)}}else G("info",f,"Ignored: "+x,b[f]?b[f].log:H)}function C(a,c,g){var e=null,r=null;if(b[a]){if(e=
b[a][c],"function"!=typeof e)throw new TypeError(c+" on iFrame["+a+"] is not a function");r=e(g)}return r}function Y(a){var c=a.id;m(c,"Removing iFrame: "+c);a.parentNode.removeChild(a);C(c,"closedCallback",c);m(c,"--");delete b[c]}function U(a){null===u&&(u={x:void 0!==h.pageXOffset?h.pageXOffset:document.documentElement.scrollLeft,y:void 0!==h.pageYOffset?h.pageYOffset:document.documentElement.scrollTop},m(a,"Get page position: "+u.x+","+u.y))}function S(a){null!==u&&(h.scrollTo(u.x,u.y),m(a,"Set page position: "+
u.x+","+u.y),u=null)}function aa(a){m(a.id,"Size reset requested by "+("init"===a.type?"host page":"iFrame"));U(a.id);Q(function(){R(a);y("reset","reset",a.iframe,a.id)},a,"reset")}function R(a){function c(e){a.iframe.style[e]=a[e]+"px";m(a.id,"IFrame ("+g+") "+e+" set to "+a[e]+"px");ba||"0"!==a[e]||(ba=!0,m(g,"Hidden iFrame detected, creating visibility listener"),na())}var g=a.iframe.id;b[g]&&(b[g].sizeHeight&&c("height"),b[g].sizeWidth&&c("width"))}function Q(a,c,g){g!==c.type&&D?(m(c.id,"Requesting animation frame"),
D(a)):a()}function y(a,c,g,e){e=e||g.id;if(b[e])if(g&&"contentWindow"in g&&null!==g.contentWindow){var r=b[e].targetOrigin;m(e,"["+a+"] Sending msg to iframe["+e+"] ("+c+") targetOrigin: "+r);g.contentWindow.postMessage(I+c,r)}else G("info",e,"["+a+"] IFrame("+e+") not found",b[e]?b[e].log:H),b[e]&&delete b[e]}function X(a){return a+":"+b[a].bodyMarginV1+":"+b[a].sizeWidth+":"+b[a].log+":"+b[a].interval+":"+b[a].enablePublicMethods+":"+b[a].autoResize+":"+b[a].bodyMargin+":"+b[a].heightCalculationMethod+
":"+b[a].bodyBackground+":"+b[a].bodyPadding+":"+b[a].tolerance+":"+b[a].inPageLinks+":"+b[a].resizeFrom+":"+b[a].widthCalculationMethod}function ca(a,c){function g(){function l(v){1/0!==b[k][v]&&0!==b[k][v]&&(a.style[v]=b[k][v]+"px",m(k,"Set "+v+" \x3d "+b[k][v]+"px"))}function t(v){if(b[k]["min"+v]>b[k]["max"+v])throw Error("Value for min"+v+" can not be greater than max"+v);}t("Height");t("Width");l("maxHeight");l("minHeight");l("maxWidth");l("minWidth")}function e(){Function.prototype.bind&&(b[k].iframe.iFrameResizer=
{close:Y.bind(null,b[k].iframe),resize:y.bind(null,"Window resize","resize",b[k].iframe),moveToAnchor:function(l){y("Move to anchor","inPageLink:"+l,b[k].iframe,k)},sendMessage:function(l){l=JSON.stringify(l);y("Send Message","message:"+l,b[k].iframe,k)}})}function r(l){z(a,"load",function(){y("iFrame.onload",l,a);var t=b[k].heightCalculationMethod in oa;!b[k].firstRun&&t&&aa({iframe:a,height:0,width:0,type:"init"})});y("init",l,a)}function B(l){l=l||{};b[k]={firstRun:!0,iframe:a,remoteHost:a.src.split("/").slice(0,
3).join("/")};if("object"!=typeof l)throw new TypeError("Options is not an object");for(var t in K)K.hasOwnProperty(t)&&(b[k][t]=l.hasOwnProperty(t)?l[t]:K[t]);t=b[k];!0===b[k].checkOrigin?(l=b[k].remoteHost,l=""===l||"file://"===l?"*":l):l="*";t.targetOrigin=l}var k=function(l){if(""===l){var t=c&&c.id||K.id+da++;l=(null!==document.getElementById(t)&&(t+=da++),t);a.id=l;H=(c||{}).log;m(l,"Added missing iframe ID: "+l+" ("+a.src+")")}return l}(a.id);k in b&&"iFrameResizer"in a?E(k,"Ignored iFrame, already setup."):
(B(c),m(k,"IFrame scrolling "+(b[k].scrolling?"enabled":"disabled")+" for "+k),a.style.overflow=!1===b[k].scrolling?"hidden":"auto",a.scrolling=!1===b[k].scrolling?"no":"yes",g(),("number"==typeof b[k].bodyMargin||"0"===b[k].bodyMargin)&&(b[k].bodyMarginV1=b[k].bodyMargin,b[k].bodyMargin=""+b[k].bodyMargin+"px"),r(X(k)),e())}function J(a,c){null===N&&(N=setTimeout(function(){N=null;a()},c))}function na(){function a(){for(var r in b)null===b[r].iframe.offsetParent||"0px"!==b[r].iframe.style.height&&
"0px"!==b[r].iframe.style.width||y("Visibility change","resize",b[r].iframe,r)}function c(r){m("window","Mutation observed: "+r[0].target+" "+r[0].type);J(a,16)}function g(){var r=document.querySelector("body");(new e(c)).observe(r,{attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0})}var e=h.MutationObserver||h.WebKitMutationObserver;e&&g()}function O(a){m("window","Trigger event: "+a);J(function(){ea("Window "+a,"resize")},16)}function fa(){function a(){ea("Tab Visable",
"resize")}"hidden"!==document.visibilityState&&(m("document","Trigger event: Visiblity change"),J(a,16))}function ea(a,c){for(var g in b)"parent"===b[g].resizeFrom&&b[g].autoResize&&!b[g].firstRun&&y(a,c,document.getElementById(g),g)}function pa(){z(h,"message",ja);z(h,"resize",function(){O("resize")});z(document,"visibilitychange",fa);z(document,"-webkit-visibilitychange",fa);z(h,"focusin",function(){O("focus")});z(h,"focus",function(){O("focus")})}function P(){function a(g,e){if(e){if(!e.tagName)throw new TypeError("Object is not a valid DOM element");
if("IFRAME"!==e.tagName.toUpperCase())throw new TypeError("Expected \x3cIFRAME\x3e tag, found \x3c"+e.tagName+"\x3e");ca(e,g);c.push(e)}}var c;return ia(),pa(),function(g,e){switch(c=[],typeof e){case "undefined":case "string":Array.prototype.forEach.call(document.querySelectorAll(e||"iframe"),a.bind(void 0,g));break;case "object":a(g,e);break;default:throw new TypeError("Unexpected data type ("+typeof e+")");}return c}}function qa(a){a.fn.iFrameResize=function(c){return this.filter("iframe").each(function(g,
e){ca(e,c)}).end()}}var da=0,H=!1,ba=!1,Z=7,I="[iFrameSizer]",L=I.length,u=null,D=h.requestAnimationFrame,oa={max:1,scroll:1,bodyScroll:1,documentElementScroll:1},b={},N=null,K={autoResize:!0,bodyBackground:null,bodyMargin:null,bodyMarginV1:8,bodyPadding:null,checkOrigin:!0,inPageLinks:!1,enablePublicMethods:!0,heightCalculationMethod:"bodyOffset",id:"iFrameResizer",interval:32,log:!1,maxHeight:1/0,maxWidth:1/0,minHeight:0,minWidth:0,resizeFrom:"parent",scrolling:!1,sizeHeight:!0,sizeWidth:!1,tolerance:0,
widthCalculationMethod:"scroll",closedCallback:function(){},initCallback:function(){},messageCallback:function(){E("MessageCallback function not defined")},resizedCallback:function(){},scrollCallback:function(){return!0}};h.jQuery&&qa(jQuery);"function"==typeof define&&define.amd?define([],P):"object"==typeof module&&"object"==typeof module.exports?module.exports=P():h.iFrameResize=h.iFrameResize||P()}(window||{});